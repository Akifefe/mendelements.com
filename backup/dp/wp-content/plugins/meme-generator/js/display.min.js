(function ($) {
    "use strict";
    $(function () {
        var toptext, btmtext, picture, script, path, date, file, name, size, style, color, stroke, output, encodedText0, encodedText1, category, tag, encodedTerm0, encodedTerm1;
        var a = '#meme-top-text-';
        var b = '#meme-bottom-text-';
        var c = '#meme-image-url-';
        var d = '#meme-home-url-';
        var e = '#meme-text-size-';
        var f = '#meme-text-style-';
        var g = '#meme-plugin-url-';
        var h = '#meme-post-name-';
        var i = '#meme-submit-btn-';
        var j = '#meme-form-success-';
        var k = '#meme-form-error-';
        var l = '#meme-live-preview-';
        var m = '#meme-content-';
        var n = '.meme-wrapper';
        var o = 'heavycapswhite';
        var p = 'heavywhite';
        var q = 'capswhite';
        var r = 'white';
        var s = 'heavycapsblack';
        var t = 'heavyblack';
        var u = 'capsblack';
        var v = 'black';
        var white = 'FFFFFF';
        var black = '000000';
        var caps = 'ALLCAPS';
        var normal = 'NORMAL';
        var pattern = /\.(gif|jpe?g|png)$/i;
        var verify = '';
        if (verify === '') {
            $.get(MemeGen.ajaxurl, {
                'action': 'ajax_memegen_verify'
            }, function (response) {
                verify = response
            })
        }
        $(document).ready(function () {
            $(n).each(function (index) {
                toptext = $(a + index).val().replace(/&/g, '&#x26;').replace(/</g, '&#x3C;').replace(/>/g, '&#x3E;').replace(/"/g, '&#x22;').replace(/'/g, '&#x27;');
                btmtext = $(b + index).val().replace(/&/g, '&#x26;').replace(/</g, '&#x3C;').replace(/>/g, '&#x3E;').replace(/"/g, '&#x22;').replace(/'/g, '&#x27;');
                encodedText0 = encodeURIComponent(toptext);
                encodedText1 = encodeURIComponent(btmtext);
                picture = encodeURIComponent($(c + index).val().replace(/(https?:\/\/)/g, '').replace(/ /g, '%20'));
                script = $(d + index).val();
                size = $(e + index).val();
                style = $(f + index).val();
                if (style === o) {
                    color = white;
                    stroke = black;
                    style = caps
                } else if (style === p) {
                    color = white;
                    stroke = black;
                    style = normal
                } else if (style === q) {
                    color = white;
                    stroke = '';
                    style = caps
                } else if (style === r) {
                    color = white;
                    stroke = '';
                    style = normal
                } else if (style === s) {
                    color = black;
                    stroke = white;
                    style = caps
                } else if (style === t) {
                    color = black;
                    stroke = white;
                    style = normal
                } else if (style === u) {
                    color = black;
                    stroke = '';
                    style = caps
                } else if (style === v) {
                    color = black;
                    stroke = '';
                    style = normal
                }
                if (script !== "" && encodedText0 !== "" && style !== "" && size !== "" || script !== "" && encodedText1 !== "" && style !== "" && size !== "" || script !== "" && picture !== "" && style !== "" && size !== "") {
                    if (verify === '') {
                        $.get(MemeGen.ajaxurl, {
                            'action': 'ajax_memegen_verify'
                        }, function (response) {
                            verify = response;
                            output = '<iframe src="' + script + '?run=meme_preview&picture=' + picture + '&style=' + style + '&color=' + color + '&stroke=' + stroke + '&text0=' + encodedText0 + '&text1=' + encodedText1 + '&size=' + size + '&verify=' + verify + '" width="450" height="350" style="max-width:100%" allowfullscreen></iframe>'
                        }).complete(function () {
                            $(l + index).html(output)
                        })
                    }
                }
                $(document).on('click', i + index, function (event) {
                    event.preventDefault();
                    $(i + index).prop('disabled', true);
                    toptext = $(a + index).val().replace(/&/g, '&#x26;').replace(/</g, '&#x3C;').replace(/>/g, '&#x3E;').replace(/"/g, '&#x22;').replace(/'/g, '&#x27;');
                    btmtext = $(b + index).val().replace(/&/g, '&#x26;').replace(/</g, '&#x3C;').replace(/>/g, '&#x3E;').replace(/"/g, '&#x22;').replace(/'/g, '&#x27;');
                    encodedText0 = encodeURIComponent(toptext);
                    encodedText1 = encodeURIComponent(btmtext);
                    picture = encodeURIComponent($(c + index).val().replace(/(https?:\/\/)/g, '').replace(/ /g, '%20'));
                    script = $(d + index).val();
                    path = $(g + index).val();
                    category = $('#meme-category-' + index).val();
                    tag = $('#meme-tag-' + index).val();
                    encodedTerm0 = encodeURIComponent(category);
                    encodedTerm1 = encodeURIComponent(tag);
                    date = new Date();
                    file = date.valueOf();
                    name = encodeURIComponent($(h + index).val().replace(/&/g, '&#x26;').replace(/</g, '&#x3C;').replace(/>/g, '&#x3E;').replace(/"/g, '&#x22;').replace(/'/g, '&#x27;'));
                    size = $(e + index).val();
                    style = $(f + index).val();
                    if (style === o) {
                        color = white;
                        stroke = black;
                        style = caps
                    } else if (style === p) {
                        color = white;
                        stroke = black;
                        style = normal
                    } else if (style === q) {
                        color = white;
                        stroke = '';
                        style = caps
                    } else if (style === r) {
                        color = white;
                        stroke = '';
                        style = normal
                    } else if (style === s) {
                        color = black;
                        stroke = white;
                        style = caps
                    } else if (style === t) {
                        color = black;
                        stroke = white;
                        style = normal
                    } else if (style === u) {
                        color = black;
                        stroke = '';
                        style = caps
                    } else if (style === v) {
                        color = black;
                        stroke = '';
                        style = normal
                    }
                    if ($(h + index).val() === '' || $(a + index).val() === '' || $(b + index).val() === '' || $(c + index).val() === '' || pattern.test($(c + index).val()) === false) {
                        $(k + index).show('fast').delay(6000).fadeOut('fast');
                        $(i + index).prop('disabled', false);
                        return false
                    }
                    $.get(script + '?run=meme_preview&picture=' + picture + '&style=' + style + '&color=' + color + '&stroke=' + stroke + '&text0=' + encodedText0 + '&text1=' + encodedText1 + '&size=' + size + '&insert=yes&file=' + file + '&verify=' + verify).complete(function () {
                        if (category === '' && tag === '') {
                            $.get(script + '?run=meme_post&file=' + file + '&name=' + name + '&verify=' + verify, function (data) {
                                if (data !== '') {
                                    window.location.href = data
                                }
                            })
                        } else if (tag === '') {
                            $.get(script + '?run=meme_post&file=' + file + '&name=' + name + '&category=' + category + '&verify=' + verify, function (data) {
                                if (data !== '') {
                                    window.location.href = data
                                }
                            })
                        } else if (category === '') {
                            $.get(script + '?run=meme_post&file=' + file + '&name=' + name + '&tag=' + tag + '&verify=' + verify, function (data) {
                                if (data !== '') {
                                    window.location.href = data
                                }
                            })
                        } else {
                            $.get(script + '?run=meme_post&file=' + file + '&name=' + name + '&category=' + category + '&tag=' + tag + '&verify=' + verify, function (data) {
                                if (data !== '') {
                                    window.location.href = data
                                }
                            })
                        }
                    });
                    $(j + index).show('fast');
                    setTimeout(function () {
                        $(j + index).fadeOut('fast', function () {
                            $(j + index).remove();
                            $(l + index).empty().html('<img src="' + path + 'img/preview.png" alt="Create A Meme" />');
                            $(m + index).find('input:text').val('');
                            $(i + index).prop('disabled', false)
                        })
                    }, 6000)
                });
                $(document).on('keyup', a + index + ',' + b + index, function () {
                    toptext = $(a + index).val().replace(/&/g, '&#x26;').replace(/</g, '&#x3C;').replace(/>/g, '&#x3E;').replace(/"/g, '&#x22;').replace(/'/g, '&#x27;');
                    btmtext = $(b + index).val().replace(/&/g, '&#x26;').replace(/</g, '&#x3C;').replace(/>/g, '&#x3E;').replace(/"/g, '&#x22;').replace(/'/g, '&#x27;');
                    encodedText0 = encodeURIComponent(toptext);
                    encodedText1 = encodeURIComponent(btmtext);
                    picture = encodeURIComponent($(c + index).val().replace(/(https?:\/\/)/g, '').replace(/ /g, '%20'));
                    script = $(d + index).val();
                    size = $(e + index).val();
                    style = $(f + index).val();
                    if (style === o) {
                        color = white;
                        stroke = black;
                        style = caps
                    } else if (style === p) {
                        color = white;
                        stroke = black;
                        style = normal
                    } else if (style === q) {
                        color = white;
                        stroke = '';
                        style = caps
                    } else if (style === r) {
                        color = white;
                        stroke = '';
                        style = normal
                    } else if (style === s) {
                        color = black;
                        stroke = white;
                        style = caps
                    } else if (style === t) {
                        color = black;
                        stroke = white;
                        style = normal
                    } else if (style === u) {
                        color = black;
                        stroke = '';
                        style = caps
                    } else if (style === v) {
                        color = black;
                        stroke = '';
                        style = normal
                    }
                    output = '<iframe src="' + script + '?run=meme_preview&picture=' + picture + '&style=' + style + '&color=' + color + '&stroke=' + stroke + '&text0=' + encodedText0 + '&text1=' + encodedText1 + '&size=' + size + '&verify=' + verify + '" width="450" height="350" style="max-width:100%" allowfullscreen></iframe>';
                    $(l + index).html(output)
                });
                $(document).on('change', c + index + ',' + f + index + ',' + e + index + ',' + a + index + ',' + b + index, function () {
                    toptext = $(a + index).val().replace(/&/g, '&#x26;').replace(/</g, '&#x3C;').replace(/>/g, '&#x3E;').replace(/"/g, '&#x22;').replace(/'/g, '&#x27;');
                    btmtext = $(b + index).val().replace(/&/g, '&#x26;').replace(/</g, '&#x3C;').replace(/>/g, '&#x3E;').replace(/"/g, '&#x22;').replace(/'/g, '&#x27;');
                    encodedText0 = encodeURIComponent(toptext);
                    encodedText1 = encodeURIComponent(btmtext);
                    picture = encodeURIComponent($(c + index).val().replace(/(https?:\/\/)/g, '').replace(/ /g, '%20'));
                    script = $(d + index).val();
                    size = $(e + index).val();
                    style = $(f + index).val();
                    if (style === o) {
                        color = white;
                        stroke = black;
                        style = caps
                    } else if (style === p) {
                        color = white;
                        stroke = black;
                        style = normal
                    } else if (style === q) {
                        color = white;
                        stroke = '';
                        style = caps
                    } else if (style === r) {
                        color = white;
                        stroke = '';
                        style = normal
                    } else if (style === s) {
                        color = black;
                        stroke = white;
                        style = caps
                    } else if (style === t) {
                        color = black;
                        stroke = white;
                        style = normal
                    } else if (style === u) {
                        color = black;
                        stroke = '';
                        style = caps
                    } else if (style === v) {
                        color = black;
                        stroke = '';
                        style = normal
                    }
                    output = '<iframe src="' + script + '?run=meme_preview&picture=' + picture + '&style=' + style + '&color=' + color + '&stroke=' + stroke + '&text0=' + encodedText0 + '&text1=' + encodedText1 + '&size=' + size + '&verify=' + verify + '" width="450" height="350" style="max-width:100%" allowfullscreen></iframe>';
                    $(l + index).html(output)
                })
            })
        })
    })
}(jQuery));